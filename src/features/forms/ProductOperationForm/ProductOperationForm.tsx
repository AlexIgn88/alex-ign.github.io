import React, { memo } from 'react';
import cn from 'clsx';
import { Button } from 'antd';
import { ProductOperationFormProps } from './types';
import { NameField } from './NameField';
import { PhotoField } from './PhotoField';
import { DescriptionField } from './DescriptionField';
import { PriceField } from './PriceField';
import { OldPriceField } from './OldPriceField';
import { AmountField } from './AmountField';
import { TypeField } from './TypeField';
import { CategoryIdField } from './CategoryIdField';
import { CategoryNameField } from './CategoryNameField';
import s from './ProductOperationForm.module.scss';

const ProductOperationForm = memo<ProductOperationFormProps>(
  ({ className, formManager, formElement, autoFocusElement, disabled, mode }) => {
    const { values, touched, errors, submitCount, handleBlur, handleSubmit, handleChange, setFieldValue } =
      formManager;

    const isProduct = mode === 'createProduct' || mode === 'editProduct';
    const isOperation = mode === 'createOperation' || mode === 'editOperation';

    const handlePriceChange = (value: number | null) => {
      setFieldValue('price', value || 0);
    };

    const handleOldPriceChange = (value: number | null) => {
      setFieldValue('oldPrice', value || undefined);
    };

    const handleAmountChange = (value: number | null) => {
      setFieldValue('amount', value || 0);
    };

    const handleTypeChange = (value: 'Cost' | 'Profit') => {
      setFieldValue('type', value);
    };

    return (
      <form ref={formElement} onSubmit={handleSubmit} className={cn(s?.root, className)}>
        <NameField
          autoFocusElement={autoFocusElement}
          onBlur={handleBlur}
          onChange={handleChange}
          value={values.name}
          errors={errors.name || ''}
          submitCount={submitCount}
          touched={touched.name || false}
          disabled={disabled}
          label={isProduct ? 'Product Name' : 'Operation Name'}
          placeholder={isProduct ? 'Enter product name' : 'Enter operation name'}
        />

        {isProduct && (
          <>
            <PhotoField
              onBlur={handleBlur}
              onChange={handleChange}
              value={values.photo || ''}
              errors={errors.photo || ''}
              submitCount={submitCount}
              touched={touched.photo || false}
              disabled={disabled}
              label="Photo URL"
              placeholder="Enter photo URL"
            />

            <DescriptionField
              onBlur={handleBlur}
              onChange={handleChange}
              value={values.desc}
              errors={errors.desc || ''}
              submitCount={submitCount}
              touched={touched.desc || false}
              disabled={disabled}
              label="Description"
              placeholder="Enter description (optional)"
            />

            <PriceField
              onBlur={handleBlur}
              onChange={handlePriceChange}
              value={values.price}
              errors={errors.price || ''}
              submitCount={submitCount}
              touched={touched.price || false}
              disabled={disabled}
              label="Price"
              placeholder="Enter price"
            />

            <OldPriceField
              onBlur={handleBlur}
              onChange={handleOldPriceChange}
              value={values.oldPrice}
              errors={errors.oldPrice || ''}
              submitCount={submitCount}
              touched={touched.oldPrice || false}
              disabled={disabled}
              label="Old Price"
              placeholder="Enter old price (optional)"
            />
          </>
        )}

        {isOperation && (
          <>
            <DescriptionField
              onBlur={handleBlur}
              onChange={handleChange}
              value={values.desc}
              errors={errors.desc || ''}
              submitCount={submitCount}
              touched={touched.desc || false}
              disabled={disabled}
              label="Description"
              placeholder="Enter description (optional)"
            />

            <AmountField
              onBlur={handleBlur}
              onChange={handleAmountChange}
              value={values.amount}
              errors={errors.amount || ''}
              submitCount={submitCount}
              touched={touched.amount || false}
              disabled={disabled}
              label="Amount"
              placeholder="Enter amount"
            />

            <TypeField
              onBlur={handleBlur}
              onChange={handleTypeChange}
              value={values.type}
              errors={errors.type || ''}
              submitCount={submitCount}
              touched={touched.type || false}
              disabled={disabled}
              label="Type"
            />
          </>
        )}

        <CategoryIdField
          onBlur={handleBlur}
          onChange={handleChange}
          value={values.categoryId || ''}
          errors={errors.categoryId || ''}
          submitCount={submitCount}
          touched={touched.categoryId || false}
          disabled={disabled}
          label="Category ID"
          placeholder="Enter category ID"
        />

        <CategoryNameField
          onBlur={handleBlur}
          onChange={handleChange}
          value={values.categoryName || ''}
          errors={errors.categoryName || ''}
          submitCount={submitCount}
          touched={touched.categoryName || false}
          disabled={disabled}
          label="Category Name"
          placeholder="Enter category name"
        />

        <Button type="primary" htmlType="submit" disabled={disabled} block>
          {mode === 'createProduct' || mode === 'createOperation' ? 'Create' : 'Update'}
        </Button>
      </form>
    );
  }
);

ProductOperationForm.displayName = 'ProductOperationForm';

export default ProductOperationForm;

